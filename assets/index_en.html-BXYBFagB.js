import{_ as c,c as r,a as n,d as p,b as e,f as l,e as a,r as o,o as d}from"./app-lSJJfXGm.js";const u={},m={class:"table-of-contents"},k={href:"https://wwqv.lanzout.com/b013cni8b",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/termux/termux-x11/issues/375",target:"_blank",rel:"noopener noreferrer"};function b(h,s){const t=o("router-link"),i=o("ExternalLinkIcon");return d(),r("div",null,[n("nav",m,[n("ul",null,[n("li",null,[e(t,{to:"#modify-apk"},{default:l(()=>s[0]||(s[0]=[a("Modify apk")])),_:1}),n("ul",null,[n("li",null,[e(t,{to:"#patcher"},{default:l(()=>s[1]||(s[1]=[a("patcher")])),_:1})]),n("li",null,[e(t,{to:"#smali-need-to-be-replaced-added"},{default:l(()=>s[2]||(s[2]=[a("smali need to be replaced/added")])),_:1})]),n("li",null,[e(t,{to:"#smali-need-to-be-edited"},{default:l(()=>s[3]||(s[3]=[a("smali need to be edited")])),_:1})]),n("li",null,[e(t,{to:"#native-libs-so"},{default:l(()=>s[4]||(s[4]=[a("native libs (.so)")])),_:1})]),n("li",null,[e(t,{to:"#androidmanifest-xml"},{default:l(()=>s[5]||(s[5]=[a("AndroidManifest.xml")])),_:1})])])]),n("li",null,[e(t,{to:"#test-results"},{default:l(()=>s[6]||(s[6]=[a("Test results")])),_:1})])])]),s[17]||(s[17]=p('<p>Xegw is developed by Twaik，now it&#39;s completely same with termux:x11.</p><h2 id="modify-apk" tabindex="-1"><a class="header-anchor" href="#modify-apk"><span>Modify apk</span></a></h2><div class="custom-container warning"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></g></svg><p class="custom-container-title">WARNING</p><p>apk of exagear should be none-xegw, in case what are going to be added inflict with xegw 1.0.</p></div><h3 id="patcher" tabindex="-1"><a class="header-anchor" href="#patcher"><span>patcher</span></a></h3>',4)),n("p",null,[s[8]||(s[8]=a("here provides a patcher.apk (")),n("a",k,[s[7]||(s[7]=a("download link. password:7bz1")),e(i)]),s[9]||(s[9]=a("). the smali, so .etc files required in the following steps, should be extracted from it. ")),s[10]||(s[10]=n("strong",null,"this apk is not able to be installed directly",-1))]),s[18]||(s[18]=p(`<p>update histroy:</p><ul><li>23.09.09: <strong>xegw 2.2</strong><ul><li>特点: <ul><li>fix: keyboard input will be translated only into unicode keys, which result in some game not recoginzing these keys. Now most regular keys will be tranlsated as linux keycode.</li><li>delete <code>FAHelper</code> call in <code>WaitForXClientConnection</code>, so that hugo apk won&#39;t crash after updated to xegw (FAHelper related codes are deleted in hugo&#39;s apk.)</li><li>the service of xegw will display a notification in the phone&#39;s notification bar, in case that it is killed when switching to background, and only a black screen is left when switching back. If it doesn&#39;t work, there&#39;s a button to disable battery optmization.</li></ul></li><li>patcher: xegw_2.2_patcher_23.09.09~tx11_23.09.03.apk<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">difference:</span>
<span class="line">com.eltechs.axs.configuration.startup.actions.WaitForXClientConnection</span>
<span class="line">com.example.datainsert.exagear.QH</span>
<span class="line">com.example.datainsert.exagear.RR</span>
<span class="line">com.termux.x11.CmdEntryPoint</span>
<span class="line">com.termux.x11.DialogOptions</span>
<span class="line">com.termux.x11.ViewForRendering</span>
<span class="line">libXlorie.so</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li>23.08.20: <strong>xegw 2.1</strong><ul><li>feature：sync termux-x11(08.16)，support dri3, is able to use turnip patched by xmem, no need of MESA_VK_WSI_DEBUG=sw。</li><li>patcher: xegw_2.1_patcher_23.08.19~tx11_23.08.16.apk. difference: libXlorie.so</li></ul></li><li>23.08.01: <strong>xegw 2.0</strong><ul><li>patcher: xegw_2.0_patcher_23.08.01~tx11_23.08.01.apk</li></ul></li></ul><h3 id="smali-need-to-be-replaced-added" tabindex="-1"><a class="header-anchor" href="#smali-need-to-be-replaced-added"><span>smali need to be replaced/added</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">com.termux.x11.*</span>
<span class="line">com.eltechs.axs.configuration.startup.actions.WaitForXClientConnection</span>
<span class="line">com.eltechs.axs.environmentService.components.XServerComponent</span>
<span class="line">com.eltechs.axs.widgets.viewOfXServer.ViewOfXServer</span>
<span class="line">com.eltechs.axs.xserver.Pointer</span>
<span class="line">com.eltechs.axs.Keyboard</span>
<span class="line">com.example.datainsert.exagear.QH</span>
<span class="line">com.example.datainsert.exagear.RR</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After downloading the patcher apk, extract the corresponding smali from the dex. Attention:</p><ul><li>When it comes to package name, the ones provided in this apk are <code>com.eltechs.ed</code>, please modify them according to the actual situation.</li><li>When extracting smali, please pay attention to extract its dependent smali together, the format is <code>class name + $ + other text.smali</code>. For example, if you extract <code>RR.smali</code>, there may be <code>RR$1.smali</code>, <code>RR$ExternalSyntheticLambda0.smali</code> should also be extracted together.</li></ul><h3 id="smali-need-to-be-edited" tabindex="-1"><a class="header-anchor" href="#smali-need-to-be-edited"><span>smali need to be edited</span></a></h3><ol><li><p><code> com.eltechs.axs.activities.StartupActivity</code></p><ul><li>Change <code>mainActivityClass</code> from <code>XServerDisplayActivity</code> to <code>com.termux.x11.MainActivity.class</code>.<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token keyword">.method</span> <span class="token keyword">protected</span> <span class="token keyword">constructor</span> <span class="token function">&lt;init&gt;</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Class</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token comment">#...</span></span>
<span class="line">    <span class="token comment">#const-class v0, Lcom/eltechs/axs/activities/XServerDisplayActivity;</span></span>
<span class="line">    const-class <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>termux<span class="token punctuation">/</span>x11<span class="token punctuation">/</span></span><span class="token class-name">MainActivity</span></span><span class="token punctuation">;</span></span>
<span class="line">    iput-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span>activities<span class="token punctuation">/</span></span><span class="token class-name">StartupActivity</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mainActivityClass</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Class</span></span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>At the end of method <code>shutdownAXSApplication（boolean）</code> stop service.<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token keyword">.method</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">shutdownAXSApplication</span><span class="token punctuation">(</span><span class="token builtin">Z</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token comment">#...</span></span>
<span class="line">    invoke-static <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>termux<span class="token punctuation">/</span>x11<span class="token punctuation">/</span></span><span class="token class-name">CmdEntryPoint</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">sendStopSignalInAppProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    return-void</span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><code>com.eltechs.axs.activities.XServerDisplayActivity </code></p><ul><li>field viewOfXServer changed from private to protected.<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment">#.field private viewOfXServer:Lcom/eltechs/axs/widgets/viewOfXServer/ViewOfXServer;</span></span>
<span class="line"><span class="token keyword">.field</span> <span class="token keyword">protected</span> <span class="token field variable">viewOfXServer</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span>widgets<span class="token punctuation">/</span>viewOfXServer<span class="token punctuation">/</span></span><span class="token class-name">ViewOfXServer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><code>com.eltechs.axs.environmentService.AXSEnvironment</code></p><ul><li>At the end of method <code>startEnvironmentService</code>, start service.<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token keyword">.method</span> <span class="token keyword">public</span> <span class="token function">startEnvironmentService</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span>environmentService<span class="token punctuation">/</span></span><span class="token class-name">AXSEnvironment$StartupCallback</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span>environmentService<span class="token punctuation">/</span></span><span class="token class-name">TrayConfiguration</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token comment">#...</span></span>
<span class="line">    invoke-static <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>termux<span class="token punctuation">/</span>x11<span class="token punctuation">/</span></span><span class="token class-name">CmdEntryPoint</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">sendStartSignalInAppProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    return-void</span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><code>com.eltechs.axs.xserver.Keyboard</code></p><ul><li>replace these two method keyPressed and keyReleased.<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token keyword">.method</span> <span class="token keyword">public</span> <span class="token function">keyPressed</span><span class="token punctuation">(</span><span class="token builtin">BI</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token keyword">.registers</span> <span class="token number">4</span></span>
<span class="line"></span>
<span class="line">    const/4 <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token number">0x1</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">95</span></span>
<span class="line">    invoke-static <span class="token punctuation">{</span><span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">p2</span><span class="token punctuation">,</span> <span class="token register variable">v0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>termux<span class="token punctuation">/</span>x11<span class="token punctuation">/</span></span><span class="token class-name">ViewForRendering</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">keyEvent</span><span class="token punctuation">(</span><span class="token builtin">IIZ</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span>
<span class="line">    return-void</span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">.method</span> <span class="token keyword">public</span> <span class="token function">keyReleased</span><span class="token punctuation">(</span><span class="token builtin">BI</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token keyword">.registers</span> <span class="token number">4</span></span>
<span class="line"></span>
<span class="line">    const/4 <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token number">0x0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">99</span></span>
<span class="line">    invoke-static <span class="token punctuation">{</span><span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">p2</span><span class="token punctuation">,</span> <span class="token register variable">v0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>termux<span class="token punctuation">/</span>x11<span class="token punctuation">/</span></span><span class="token class-name">ViewForRendering</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">keyEvent</span><span class="token punctuation">(</span><span class="token builtin">IIZ</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span>
<span class="line">    return-void</span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><h3 id="native-libs-so" tabindex="-1"><a class="header-anchor" href="#native-libs-so"><span>native libs (.so)</span></a></h3><p>Add：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">apk/lib/armeabi-v7a/libvirgl_test_server.so</span>
<span class="line">apk/lib/armeabi-v7a/libXlorie.so</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Extract the .so file from patcher apk.</p><h3 id="androidmanifest-xml" tabindex="-1"><a class="header-anchor" href="#androidmanifest-xml"><span>AndroidManifest.xml</span></a></h3><p>Add: an activity and a service.</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span></span>
<span class="line">	<span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@style/ThemeDefaultFullscreen<span class="token punctuation">&quot;</span></span></span>
<span class="line">	<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.termux.x11.MainActivity<span class="token punctuation">&quot;</span></span></span>
<span class="line">	<span class="token attr-name"><span class="token namespace">android:</span>screenOrientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sensorLandscape<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span></span>
<span class="line">	<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.termux.x11.CmdEntryPoint<span class="token punctuation">&quot;</span></span></span>
<span class="line">	<span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span></span>
<span class="line">	<span class="token attr-name"><span class="token namespace">android:</span>process</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>:xserver<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span></span>
<span class="line">			<span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.action.MAIN<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="test-results" tabindex="-1"><a class="header-anchor" href="#test-results"><span>Test results</span></a></h2><p>Install the modified apk, it should open normally and display the screen normally after starting the container.</p>`,17)),n("ul",null,[n("li",null,[s[12]||(s[12]=a("If it only shows black screen and arrow mouse, you need to add ")),s[13]||(s[13]=n("code",null,"-legacy-drawing",-1)),s[14]||(s[14]=a(" paramete (")),n("a",v,[s[11]||(s[11]=a("see termux:x11 issue for details")),e(i)]),s[15]||(s[15]=a("). You can add float action button with EDPatch v0.0.6 and above, checking the Xegw option. Or modify com.termux.x11.CmdEntryPoint class to pass this parameter when calling start(String[])."))]),s[16]||(s[16]=n("li",null,[a("The keys and mouses input require xkb. Please make sure there's "),n("code",null,"/usr/share/X11/xkb"),a(" in obb.")],-1))])])}const x=c(u,[["render",b],["__file","index_en.html.vue"]]),f=JSON.parse('{"path":"/blogs/2023/summer/exagearXegw/index_en.html","title":"","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Modify apk","slug":"modify-apk","link":"#modify-apk","children":[{"level":3,"title":"patcher","slug":"patcher","link":"#patcher","children":[]},{"level":3,"title":"smali need to be replaced/added","slug":"smali-need-to-be-replaced-added","link":"#smali-need-to-be-replaced-added","children":[]},{"level":3,"title":"smali need to be edited","slug":"smali-need-to-be-edited","link":"#smali-need-to-be-edited","children":[]},{"level":3,"title":"native libs (.so)","slug":"native-libs-so","link":"#native-libs-so","children":[]},{"level":3,"title":"AndroidManifest.xml","slug":"androidmanifest-xml","link":"#androidmanifest-xml","children":[]}]},{"level":2,"title":"Test results","slug":"test-results","link":"#test-results","children":[]}],"git":{"createdTime":1690868772000,"updatedTime":1711092212000,"contributors":[{"name":"ewt45","email":"79033456+ewt45@users.noreply.github.com","commits":4}]},"filePathRelative":"blogs/2023/summer/exagearXegw/index_en.md"}');export{x as comp,f as data};
