import{_ as i,c as u,a as n,d as o,b as e,f as l,e as a,r as c,o as r}from"./app-lSJJfXGm.js";const k="/assets/1-DVQpsGip.png",d="/assets/2-CTYAFZEJ.png",v="/assets/3-Cwrno966.png",m={},b={class:"table-of-contents"},g={href:"https://www.bilibili.com/video/BV1Gd4y167kg/",target:"_blank",rel:"noopener noreferrer"},y={href:"https://www.bilibili.com/video/BV1KW4y1E7jP?share_source=copy_web&vd_source=de2377a6a91c81456918f0dc49bfbd5d",target:"_blank",rel:"noopener noreferrer"},x={href:"https://wwn.lanzout.com/iJPjE0eatq6b",target:"_blank",rel:"noopener noreferrer"},K={href:"https://wwn.lanzout.com/icaPi0ebkdla",target:"_blank",rel:"noopener noreferrer"},f={href:"https://zhuanlan.zhihu.com/p/423502840",target:"_blank",rel:"noopener noreferrer"},h={href:"https://elixir.bootlin.com/linux/v6.0.2/source/include/uapi/linux/input-event-codes.h",target:"_blank",rel:"noopener noreferrer"},w={href:"https://github.com/D-Programming-Deimos/libX11/blob/master/c/X11/keysymdef.h",target:"_blank",rel:"noopener noreferrer"},X={href:"https://zhuanlan.zhihu.com/p/423502840",target:"_blank",rel:"noopener noreferrer"};function L(C,s){const t=c("router-link"),p=c("ExternalLinkIcon");return r(),u("div",null,[n("nav",b,[n("ul",null,[n("li",null,[e(t,{to:"#前言"},{default:l(()=>s[0]||(s[0]=[a("前言")])),_:1})]),n("li",null,[e(t,{to:"#演示视频"},{default:l(()=>s[1]||(s[1]=[a("演示视频：")])),_:1})]),n("li",null,[e(t,{to:"#将此功能添加到任意apk"},{default:l(()=>s[2]||(s[2]=[a("将此功能添加到任意apk")])),_:1})]),n("li",null,[e(t,{to:"#探索过程"},{default:l(()=>s[3]||(s[3]=[a("探索过程")])),_:1})]),n("li",null,[e(t,{to:"#总结"},{default:l(()=>s[4]||(s[4]=[a("总结")])),_:1})])])]),s[28]||(s[28]=n("h2",{id:"前言",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前言"},[n("span",null,"前言")])],-1)),n("p",null,[s[6]||(s[6]=a("在此之前，想在模拟器里输入中文非常困难，因为安卓输入法输入无效，只能在模拟器里装中文输入法，而模拟器支持的中文输入法也只有南极星输入法而已（")),n("a",g,[s[5]||(s[5]=a("测试视频")),e(p)]),s[7]||(s[7]=a("）,就算成功运行了南极星输入也不是很方便。"))]),s[29]||(s[29]=n("p",null,[a("于是研究了一下，发现添加中文输入支持还是很简单的，最主要的是"),n("strong",null,"手机的输入法要支持切换成中文才行"),a("，我之前用的谷歌Gboard输入法，切中文直接闪退，只能显示英文键盘布局，后来换成了系统内置的百度输入法才能切到中文输入法。")],-1)),s[30]||(s[30]=n("h2",{id:"演示视频",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#演示视频"},[n("span",null,"演示视频：")])],-1)),n("p",null,[n("a",y,[s[8]||(s[8]=a("【安卓Exagear】修改以支持使用安卓输入法直接输入中文，无需在模拟器安装南极星输入法 ")),e(p)])]),s[31]||(s[31]=n("iframe",{src:"//player.bilibili.com/player.html?aid=944313799&bvid=BV1KW4y1E7jP&cid=868004364&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true"},null,-1)),s[32]||(s[32]=n("h2",{id:"将此功能添加到任意apk",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#将此功能添加到任意apk"},[n("span",null,"将此功能添加到任意apk")])],-1)),s[33]||(s[33]=n("p",null,"如果你掌握apk的基础修改知识，可以通过本小节的教程将此功能添加到你自己的apk中。如果你是小白，那么应该去找已经修改好的apk直接使用。",-1)),n("ol",null,[n("li",null,[n("p",null,[s[10]||(s[10]=a("将")),n("a",x,[s[9]||(s[9]=a("CHCharSupport.smali")),e(p)]),s[11]||(s[11]=a("导入到dex中。"))])]),s[15]||(s[15]=o(`<li><p>在<code>com.eltechs.axs.Keyboard</code>类中（注意不是<code>com.eltechs.axs.xserver.Keyboard</code>）添加一个方法 convertUnicodeToXKey2</p><details class="custom-container details"><summary class="custom-container-title">点击展开代码</summary><div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment"># 修改 新建一个方法</span></span>
<span class="line"><span class="token keyword">.method</span> <span class="token keyword">private</span> <span class="token function">convertUnicodeToXKey2</span><span class="token punctuation">(</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">.registers</span> <span class="token number">6</span></span>
<span class="line">    <span class="token keyword">.param</span> <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token string">&quot;i&quot;</span>    <span class="token comment"># I</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.prologue</span></span>
<span class="line">    const/high16 <span class="token register variable">v3</span><span class="token punctuation">,</span> <span class="token number">0x1000000</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">197</span></span>
<span class="line">    const/4 <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token number">0x0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">198</span></span>
<span class="line">    <span class="token keyword">.local</span> <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token string">&quot;returnKey&quot;</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line">    const/high16 <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token number">0x10000</span></span>
<span class="line"></span>
<span class="line">    if-gt <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token label property">cond_d</span></span>
<span class="line"></span>
<span class="line">    iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">UnicodeToXKeyMap</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    aget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span></span>
<span class="line"></span>
<span class="line">    if-nez <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token label property">cond_32</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">199</span></span>
<span class="line">    <span class="token punctuation">:</span><span class="token label property">cond_d</span></span>
<span class="line">    const-string <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token string">&quot;Keyboard&quot;</span></span>
<span class="line"></span>
<span class="line">    const-string <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token string">&quot;convertUnicodeToXKey: \\u8d85\\u51fa\\u6570\\u7ec465535\\u8303\\u56f4&quot;</span></span>
<span class="line"></span>
<span class="line">    invoke-static <span class="token punctuation">{</span><span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">android<span class="token punctuation">/</span>util<span class="token punctuation">/</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">200</span></span>
<span class="line">    new-instance <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.end</span> <span class="token keyword">local</span> <span class="token register variable">v0</span>    <span class="token comment"># &quot;returnKey&quot;:Lcom/eltechs/axs/Keyboard$XKey;</span></span>
<span class="line">    sget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">avaiKeyCode</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">KeyCodesX</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    sget <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">currIndex</span><span class="token punctuation">:</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    aget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v2</span></span>
<span class="line"></span>
<span class="line">    add-int <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">v3</span></span>
<span class="line"></span>
<span class="line">    invoke-direct <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">&lt;init&gt;</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">KeyCodesX</span></span><span class="token punctuation">;</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">201</span></span>
<span class="line">    <span class="token keyword">.restart</span> local <span class="token register variable">v0</span>    <span class="token comment"># &quot;returnKey&quot;:Lcom/eltechs/axs/Keyboard$XKey;</span></span>
<span class="line">    sget <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">currIndex</span><span class="token punctuation">:</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    add-int/lit8 <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token number">0x1</span></span>
<span class="line"></span>
<span class="line">    sget-object <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">avaiKeyCode</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">KeyCodesX</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    array-length <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token register variable">v2</span></span>
<span class="line"></span>
<span class="line">    rem-int/2addr <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v2</span></span>
<span class="line"></span>
<span class="line">    sput <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">currIndex</span><span class="token punctuation">:</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">210</span></span>
<span class="line">    <span class="token punctuation">:</span><span class="token label property">cond_2b</span></span>
<span class="line">    <span class="token punctuation">:</span><span class="token label property">goto_2b</span></span>
<span class="line">    if-nez <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token label property">cond_31</span></span>
<span class="line"></span>
<span class="line">    iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">UnicodeToXKeyMap</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    aget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.end</span> <span class="token keyword">local</span> <span class="token register variable">v0</span>    <span class="token comment"># &quot;returnKey&quot;:Lcom/eltechs/axs/Keyboard$XKey;</span></span>
<span class="line">    <span class="token punctuation">:</span><span class="token label property">cond_31</span></span>
<span class="line">    return-object <span class="token register variable">v0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">205</span></span>
<span class="line">    <span class="token keyword">.restart</span> local <span class="token register variable">v0</span>    <span class="token comment"># &quot;returnKey&quot;:Lcom/eltechs/axs/Keyboard$XKey;</span></span>
<span class="line">    <span class="token punctuation">:</span><span class="token label property">cond_32</span></span>
<span class="line">    iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">UnicodeToXKeyMap</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    aget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span></span>
<span class="line"></span>
<span class="line">    iget <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">keysym</span><span class="token punctuation">:</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    if-le <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v3</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token label property">cond_2b</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">206</span></span>
<span class="line">    iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">UnicodeToXKeyMap</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    aget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span></span>
<span class="line"></span>
<span class="line">    sget-object <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">avaiKeyCode</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">KeyCodesX</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    sget <span class="token register variable">v3</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">currIndex</span><span class="token punctuation">:</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    aget-object <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token register variable">v3</span></span>
<span class="line"></span>
<span class="line">    iput-object <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">keycode</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">KeyCodesX</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">207</span></span>
<span class="line">    sget <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">currIndex</span><span class="token punctuation">:</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    add-int/lit8 <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token number">0x1</span></span>
<span class="line"></span>
<span class="line">    sget-object <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">avaiKeyCode</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">KeyCodesX</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    array-length <span class="token register variable">v2</span><span class="token punctuation">,</span> <span class="token register variable">v2</span></span>
<span class="line"></span>
<span class="line">    rem-int/2addr <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v2</span></span>
<span class="line"></span>
<span class="line">    sput <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ewt45<span class="token punctuation">/</span>exagearsupportv7<span class="token punctuation">/</span>input<span class="token punctuation">/</span></span><span class="token class-name">CHCharSupport</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">currIndex</span><span class="token punctuation">:</span><span class="token builtin">I</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">208</span></span>
<span class="line">    iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">UnicodeToXKeyMap</span><span class="token punctuation">:</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    aget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span></span>
<span class="line"></span>
<span class="line">    goto <span class="token punctuation">:</span><span class="token label property">goto_2b</span></span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></li><li><p>在<code>com.eltechs.axs.Keyboard</code>类中，将handleUnicodeKeyType方法中调用convertUnicodeToXKey的地方改为convertUnicodeToXKey2</p><div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line">    <span class="token comment">#将convertUnicodeToXKey改为convertUnicodeToXKey2</span></span>
<span class="line">    <span class="token comment">#invoke-direct {p0, v3}, Lcom/eltechs/axs/Keyboard;-&gt;convertUnicodeToXKey(I)Lcom/eltechs/axs/Keyboard$XKey;</span></span>
<span class="line">    invoke-direct <span class="token punctuation">{</span><span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token register variable">v3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">convertUnicodeToXKey2</span><span class="token punctuation">(</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>axs<span class="token punctuation">/</span></span><span class="token class-name">Keyboard$XKey</span></span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>编译，签名，重装apk。进入环境后调出键盘并切换至中文输入，此时即可正常输入中文。</p></li>`,3)),n("li",null,[n("p",null,[s[13]||(s[13]=a("这里提供一个")),n("a",K,[s[12]||(s[12]=a("成品")),e(p)]),s[14]||(s[14]=a("仅供测试，不保证任何其他功能正常，请尽量不要用于测试中文输入以外的用途。"))])])]),s[34]||(s[34]=n("h2",{id:"探索过程",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#探索过程"},[n("span",null,"探索过程")])],-1)),s[35]||(s[35]=n("p",null,"这次依然是运气占了很大一部分。",-1)),s[36]||(s[36]=n("p",null,"之前浪费了不少时间考虑如何让调出的输入法可以切换成中文输入，不行的话就要加EditText了。后来偶然想起之前群友发的视频，里面是能直接输入中文的，于是换了一个输入法，从Gboard改成内置的百度输入法华为版，就能用中文了。。。Gboard被调起的时候默认是英文，切成中文就闪退了。再调起状态栏显示的是中文但实际上还是英文布局，输入字母也没有顶部的候选词，而且连顶部的那些输入法设置也没有，而且俄语葡萄牙语这种都tm能用就中文用不了！反正挺特殊吧，暂时不打算折腾Gboard如何调出中文输入这个了，就当做是输入法自身问题吧。",-1)),s[37]||(s[37]=n("p",null,"能够调出中文布局之后，测试发现输入中文没反应，然后测试了其他字符，测到emoji的时候窗口居然直接闪退了，返回到了安卓布局，幸好exa的x11是java实现的可以看到报错。",-1)),s[38]||(s[38]=n("p",null,[n("img",{src:k,alt:"图1"})],-1)),s[39]||(s[39]=n("p",null,[a("看报错是因为对应unicode码大于65536，导致数组越界。看handleUnicodeKeyType，大概就是从按键码数组（"),n("code",null,"private final XKey[] UnicodeToXKeyMap = new XKey[65536];"),a("）中查找，然后把对应的按键发送给系统内部输入。")],-1)),s[40]||(s[40]=n("p",null,"查了一下中文的基本汉字Unicode编码范围在4E00-9FA5。扩展B的范围是20000-2A6DF，如果从扩展B里选一个字来输入，那么窗口一样会闪退。",-1)),n("p",null,[s[17]||(s[17]=a("然后又浪费了不少时间，最终才确定XKey的两个属性keycode和keysym是啥：")),n("a",f,[s[16]||(s[16]=a("linux下的keycode与keysym")),e(p)]),s[18]||(s[18]=a("。"))]),n("ul",null,[n("li",null,[s[20]||(s[20]=a("keycode是键盘对应键位的代码，查询哪个键位对应哪个数字可以看")),n("a",h,[s[19]||(s[19]=a("code字段")),e(p)]),s[21]||(s[21]=a("。"))]),n("li",null,[s[23]||(s[23]=a("keysym是键位的映射。因为有些语言比如日语，a的那个键位对应了一个片假名，那么按a的时候keycode还是a的keycode，但是keysym是那个片假名对应的keysym。这个工作不需要输入法参与。查询哪个字符或其他什么东西对应的什么keysym可以看")),n("a",w,[s[22]||(s[22]=a("查询uincode码对应的keysym")),e(p)])])]),s[41]||(s[41]=o('<p>KeyBoard类新建时会初始化这个数组，将特定字符的unicode码作为下标，对应下标的XKey初始化填入keycode和keysym。如图所示。</p><p><img src="'+d+'" alt="图2"></p><p><img src="'+v+'" alt="图3"></p><p>观察可知：</p><ul><li>不是每个字符都初始化了对应的XKey。没有被初始化的字符在输入时会被无视掉。</li><li>初始XKey时用到的keycode只有a-z这些字母，猜测大概都是各种语言的键盘布局。但是中文（这里只讨论简体，26键）由于不是字母语言，所以没法简单地用26个按键+对应的键位映射实现输入。</li></ul><p>然后又浪费了很长时间，因为没有思路了，把dex里的整个流程都看了一遍，甚至复刻了一大堆代码到自己的项目里，最后发现调用到native方法里去了，就算找到了这里，也没能找到有用的信息，唯一确定的就是各种传参的过程中，只传了keycode，keysym，以及modifier（shift这样的组合键）的mask之类的，没有直接传字符。</p><p>从已知信息出发，keycode传的是byte值肯定不能代表unicode码，keysym是int值但是主要是为键盘键位设计的，也没有查到中文字符的keysym，modifier就更跟字符没关系了。只能考虑从keysym入手。尝试了一下把中文字符的keysym设置成和unicode码一样的，并没有反应。想着再去确认一下中文基本汉字的那些u码如果keysym都没被用到，实在不行就写个linux的keysym监听吧，监听到如果keysym在中文u码范围就输入中文。结果仔细一看，发现keysym有些超大的值，比如0x1000ddf，对应unicode字符是0x0ddf，正好差了0x1000000。又看了几个发现0x1000000往上的那些貌似都是这样，低四位直接用的unicode码了，遂试了一下中文u码加0x100,0000作为keysym，竟可以输入中文了。。。。</p><p>探寻之路基本上就到此结束了。只需要在初始化XKey数组时，给中文字符初始化上对应的XKey对象，随便填入一个keycode，keysym设置成u码+0x1000000。不过在实际测试中还有一点小问题，就是一个字一个字输入没问题，输入两个字以上，所有字都会变成最后一个字。猜测是因为我所有中文的keycode都是同一个，于是在检测到输入，通过u码获取Xkey对象时，先动态修改一下其keycode再返回xkey对象。这样就差不多了。另外还有一个问题就是数组只有66536个元素，如果想输入u码大于65536的字符，可以再添加一个判断，当u码大于65536时直接新建一个xkey并返回。另外一个问题是输入回车，中文标点又会闪退，这些并不在基础汉字范围内所以对应的xkey仍然是null，所以再加个判断为null时new 一个XKey返回就好了。</p><p>补充：发现需要big5的繁体游戏内还是输入不了文字，这个貌似只适用于utf-8</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2>',10)),n("ul",null,[n("li",null,[n("a",X,[s[24]||(s[24]=a("linux下的keycode与keysym")),e(p)]),s[25]||(s[25]=a("。"))]),s[26]||(s[26]=n("li",null,"想支持中文（更多unicode字符）输入，实际上需要修改的只有XKey的keysym。",-1)),s[27]||(s[27]=n("li",null,"运气不错。",-1))])])}const T=i(m,[["render",L],["__file","index.html.vue"]]),I=JSON.parse('{"path":"/blogs/2022/autumn/exagearZHChars/","title":"使exagear支持安卓输入法的中文输入，无需在环境中安装南极星输入法","lang":"zh-CN","frontmatter":{"date":"2022-10-21 15:18","title":"使exagear支持安卓输入法的中文输入，无需在环境中安装南极星输入法","categories":["技术","exagear"],"tags":["x11","keycode","keysym","unicode","exagear"]},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"演示视频：","slug":"演示视频","link":"#演示视频","children":[]},{"level":2,"title":"将此功能添加到任意apk","slug":"将此功能添加到任意apk","link":"#将此功能添加到任意apk","children":[]},{"level":2,"title":"探索过程","slug":"探索过程","link":"#探索过程","children":[]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"git":{"createdTime":1666354376000,"updatedTime":1670051927000,"contributors":[{"name":"ewt45","email":"79033456+ewt45@users.noreply.github.com","commits":6}]},"filePathRelative":"blogs/2022/autumn/exagearZHChars/index.md"}');export{T as comp,I as data};
