import{_ as u,c as r,a as s,d as i,e as a,b as e,f as t,r as c,o as d}from"./app-lSJJfXGm.js";const k={},m={class:"custom-container tip"},b={class:"table-of-contents"},g={href:"https://www.bilibili.com/video/BV1bD4y1k7ch?share_source=copy_web&vd_source=de2377a6a91c81456918f0dc49bfbd5d",target:"_blank",rel:"noopener noreferrer"},v={href:"https://askubuntu.com/a/1193281",target:"_blank",rel:"noopener noreferrer"},h={href:"https://wwn.lanzout.com/iduTq0dmf7cf",target:"_blank",rel:"noopener noreferrer"},f={href:"https://dl.winehq.org/wine-builds/ubuntu/dists",target:"_blank",rel:"noopener noreferrer"},w={href:"https://dl.winehq.org/wine-builds/ubuntu/dists/bionic/main/binary-i386/",target:"_blank",rel:"noopener noreferrer"};function y(x,n){const l=c("RouteLink"),o=c("router-link"),p=c("ExternalLinkIcon");return d(),r("div",null,[s("div",m,[n[3]||(n[3]=i('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">tips</p>',2)),s("p",null,[n[1]||(n[1]=a("this is an english translation of the blog ")),e(l,{to:"/blogs/2022/autumn/exagearMultiWine/"},{default:t(()=>n[0]||(n[0]=[a("MultiWine Support")])),_:1}),n[2]||(n[2]=a("."))])]),s("nav",b,[s("ul",null,[s("li",null,[e(o,{to:"#demo-video"},{default:t(()=>n[4]||(n[4]=[a("Demo video")])),_:1})]),s("li",null,[e(o,{to:"#introduction"},{default:t(()=>n[5]||(n[5]=[a("Introduction")])),_:1})]),s("li",null,[e(o,{to:"#concept"},{default:t(()=>n[6]||(n[6]=[a("Concept")])),_:1})]),s("li",null,[e(o,{to:"#to-modify-dex-smali"},{default:t(()=>n[7]||(n[7]=[a("To modify dex(smali)")])),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#my-classes"},{default:t(()=>n[8]||(n[8]=[a("My Classes")])),_:1})]),s("li",null,[e(o,{to:"#class-managercontainersfragment"},{default:t(()=>n[9]||(n[9]=[a("class ManagerContainersFragment")])),_:1})]),s("li",null,[e(o,{to:"#class-guestcontainerconfig"},{default:t(()=>n[10]||(n[10]=[a("class GuestContainerConfig")])),_:1})]),s("li",null,[e(o,{to:"#class-guestcontainersmanager"},{default:t(()=>n[11]||(n[11]=[a("class GuestContainersManager")])),_:1})]),s("li",null,[e(o,{to:"#class-startguest"},{default:t(()=>n[12]||(n[12]=[a("class StartGuest")])),_:1})]),s("li",null,[e(o,{to:"#after-modifying-dex"},{default:t(()=>n[13]||(n[13]=[a("after modifying dex")])),_:1})])])]),s("li",null,[e(o,{to:"#to-add-a-new-version-of-wine"},{default:t(()=>n[14]||(n[14]=[a("To add a new version of wine")])),_:1}),s("ul",null,[s("li",null,[e(o,{to:"#add-wine-binary-files-into-obb"},{default:t(()=>n[15]||(n[15]=[a("add wine binary files into obb")])),_:1})]),s("li",null,[e(o,{to:"#add-presets-folder-into-obb-optional"},{default:t(()=>n[16]||(n[16]=[a("add presets folder into obb(optional)")])),_:1})]),s("li",null,[e(o,{to:"#add-one-line-in-winesversioninfo-txt"},{default:t(()=>n[17]||(n[17]=[a("add one line in WinesVersionInfo.txt")])),_:1})]),s("li",null,[e(o,{to:"#reinstall-apk-uncompress-obb-create-new-container"},{default:t(()=>n[18]||(n[18]=[a("Reinstall apk, uncompress obb, create new container")])),_:1})])])])])]),n[38]||(n[38]=s("h2",{id:"demo-video",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#demo-video"},[s("span",null,"Demo video")])],-1)),n[39]||(n[39]=s("p",null,"This video shows that launching different versions of wine ,both from desktop shortcut and container's settings, works fine. It also shows you how to add a new version of wine.",-1)),s("p",null,[s("a",g,[n[19]||(n[19]=a("【安卓Exagear】单apk支持多版本wine共存 大概就这样了】")),e(p)])]),n[40]||(n[40]=s("iframe",{src:"//player.bilibili.com/player.html?aid=731433211&bvid=BV1bD4y1k7ch&cid=858758941&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"500",height:"300"}," 不支持iframe视频无法显示",-1)),n[41]||(n[41]=s("h2",{id:"introduction",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#introduction"},[s("span",null,"Introduction")])],-1)),n[42]||(n[42]=s("p",null,"Instead of providing a finished apk, i'd like to tell you how to add this function to any exagear apk.",-1)),n[43]||(n[43]=s("p",null,"What i won't explain in detail:",-1)),n[44]||(n[44]=s("ul",null,[s("li",null,"how to patching obb"),s("li",null,"how to editing dex/smali from apk")],-1)),s("p",null,[n[22]||(n[22]=a("Here's a tutorial about ")),s("a",v,[n[20]||(n[20]=a("multiwine on linux")),e(p)]),n[23]||(n[23]=a(", pretty easy.Here's ")),e(l,{to:"/blogs/2022/autumn/exagearMultiWine/deprecated.html"},{default:t(()=>n[21]||(n[21]=[a("my first try of multiwine")])),_:1}),n[24]||(n[24]=a("."))]),n[45]||(n[45]=i('<p>The main idea is to add the certain wine&#39;s execute path into Environment Variables of linux when launching. The launching process is no more than calling &#39;wine&#39; command . As long as the system can detect wine program file in it&#39;s Environment Variables, wine will be launched. What was done is far from perfect, but it works so I&#39;m probably not gonna change it anymore.</p><p>There are also many details, let&#39;s just leave it.</p><h2 id="concept" tabindex="-1"><a class="header-anchor" href="#concept"><span>Concept</span></a></h2><p>Before modifying, we need to design the view and logic.</p><ul><li>Usually, when tapping the plus sign on the right-top of the view, a new container is created. To support multiwine, a subMenu with some wine-version menu options should be inflated when tapping the plus sign, so that users is able to choose a certain version of wine. Considering that it should support any number of wine versions and simplify the operation of adding a new wine version, the code should read wine versions info from apk/assets/WinesVersionInfo.txt, and create the subMenu dynamicly. The writting rules of this txt are as follows: <ul><li>File is encoded with utf-8. Don&#39;t leave any empty line.</li><li>Each line represents one wine version.it contains three parts: wineName, wineInstallPath and winePatternPath.Seperate each part with a blank space. <br> e.g. <code>wine3.0.5 /opt/wine3.0.5/opt/wine-stable /opt/guestcont-pattern/</code></li><li>a line start with <code>#</code> represents a comment.</li><li>a line start with <code>usage:</code> is instructions that will be added to the subMenu as the last menu option. if clicked, a dialog will pop out and shows the instructions written by you.</li></ul></li><li>When creating a new container, exagear copys the dir /opt/guestcont-pattern to the new container. This dir can be used as presets for containers.To support multiwine, multiple pattern path should be supported.</li><li>When launching a container, exagear calls wine command to show a virtual desktop. Nornally wine is install to default path that is already added to linux&#39;s Environment Variables, so there is no need to call it with absolute path. To support multiwine, certain wine install path should be added to Environment Variables PATH when launching. <ul><li>When launching from container settings it calls a command written in dex. When lauching from desktop shortcuts, it calls a command written in .desktop file.</li></ul></li></ul><h2 id="to-modify-dex-smali" tabindex="-1"><a class="header-anchor" href="#to-modify-dex-smali"><span>To modify dex(smali)</span></a></h2>',6)),s("p",null,[n[26]||(n[26]=a("I'll just skip the process of writting java code. In this section, how to add multiwine support(provided smali code) to any exagear apk is illustrated. If you have difficulty understanding what is going on in this section, maybe you need to get an apk that is already modified, and check the next section ")),e(l,{to:"/blogs/2022/autumn/exagearMultiWine/index_EN.html/#to-add-a-new-version-of-wine"},{default:t(()=>n[25]||(n[25]=[a("To add a new version of wine")])),_:1})]),n[46]||(n[46]=i('<div class="custom-container warning"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></g></svg><p class="custom-container-title">attention</p><ul><li>Codes that written by me are provided as smali files. Simply import them into dex. For the codes from Exagear&#39;s dex that need to be modified, smali samples are provided. They may not be accurate so be cautious with registers and package name ,etc. The samples sometimes add some extra codes to indicate where the modified codes are, so copy codes only between <code>#start</code> and <code>#end</code>.</li><li>The package name in provided smali and codes below are <code>com.eltechs.ed</code>. When replacing it with other package names, take care that there&#39;s a string containing this package name also needs to be repalced.</li><li>For some reason, if you changed the wineInstallPath in txt and reinstalled the apk, you have to remove the old container and create a new one, otherwise it won&#39;t use the new wineInstallPath.</li><li>For some reason, exagear can&#39;t recoginze $PATH when modifying Environment Variables. So I have to write all the default PATH on my own. LD_LIBRARY_PATH is the same. If you are used to add some custom paths to PATH and LD_LIBRARY_PATH, you need to add those again in my provided smali file(Search PATH or LD_LIBRARY_PATH to locate them).</li></ul></div><hr><p>involved classes from exagear dex</p><ul><li>wine-version options subMenu: class ManagerContainersFragment</li><li>extra background operations when creating containers: class GuestContainerConfig, GuestContainersManager</li><li>extra background operations when launching containers: class StartGuest</li></ul><hr><h3 id="my-classes" tabindex="-1"><a class="header-anchor" href="#my-classes"><span>My Classes</span></a></h3>',6)),s("p",null,[s("a",h,[n[27]||(n[27]=a("download link")),e(p)]),n[28]||(n[28]=a(". Add all classes in zip into dex."))]),n[47]||(n[47]=i(`<h3 id="class-managercontainersfragment" tabindex="-1"><a class="header-anchor" href="#class-managercontainersfragment"><span>class ManagerContainersFragment</span></a></h3><ul><li>deleted method <code>onOptionsItemSelected</code></li><li>comment out all contents of method <code>onCreateOptionMenu</code>, then add these<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment">#start. call my method to setup submenu. send in instance of menu and task</span></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">setOptionMenu</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">android<span class="token punctuation">/</span>view<span class="token punctuation">/</span></span><span class="token class-name">Menu</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"><span class="token comment">#end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>add a new method<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment"># virtual methods</span></span>
<span class="line"><span class="token comment">#start add a method. call it from outside to run task of creating containers</span></span>
<span class="line"><span class="token keyword">.method</span> <span class="token keyword">public</span> <span class="token function">callToCreateNewContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token keyword">.registers</span> <span class="token number">3</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.prologue</span></span>
<span class="line">    const/4 <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token number">0x0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">58</span></span>
<span class="line">    new-instance <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment$ContAsyncTask</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    invoke-direct <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment$ContAsyncTask</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">&lt;init&gt;</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment</span></span><span class="token punctuation">;</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span>
<span class="line">    new-array <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    invoke-virtual <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment$ContAsyncTask</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Object</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">android<span class="token punctuation">/</span>os<span class="token punctuation">/</span></span><span class="token class-name">AsyncTask</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">59</span></span>
<span class="line">    return-void</span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"><span class="token comment">#end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="class-guestcontainerconfig" tabindex="-1"><a class="header-anchor" href="#class-guestcontainerconfig"><span>class GuestContainerConfig</span></a></h3><ul><li>In method <code>loadDefaults</code>, add these at the end<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment">#start. add wine related info</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mCont</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">writeWineVerToContainerConfig</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"><span class="token comment">#end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>In method <code>cloneContainerConfig</code>(). the registers p0 p1 are modified at the end, so add these before that.<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment">#start. copy the old container&#39;s wine related info</span></span>
<span class="line"><span class="token comment"># v0 old id   </span></span>
<span class="line">iget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># v1 new id</span></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">cloneWineVerToContainerConfig</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"><span class="token comment">#end</span></span>
<span class="line"><span class="token keyword">.line</span> <span class="token number">75</span></span>
<span class="line">iget-object <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mConfig</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mConfig</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-virtual <span class="token punctuation">{</span><span class="token register variable">p0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">getRunGuideShown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Boolean</span></span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="class-guestcontainersmanager" tabindex="-1"><a class="header-anchor" href="#class-guestcontainersmanager"><span>class GuestContainersManager</span></a></h3><ul><li>In method <code>initNewContainer</code>, comment out the line with string <code>&quot;/opt/guestcont/pattern&quot;</code>. Then add these below it<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment"># start. change the path of guestcont-pattern </span></span>
<span class="line"><span class="token comment"># comment out this line</span></span>
<span class="line"><span class="token comment"># const-string v2, &quot;/opt/guestcont-pattern/&quot;</span></span>
<span class="line"><span class="token comment"># add these</span></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">getCustomPatternPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">move-result-object <span class="token register variable">v2</span></span>
<span class="line"><span class="token comment">#end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="class-startguest" tabindex="-1"><a class="header-anchor" href="#class-startguest"><span>class StartGuest</span></a></h3><ul><li><p>In method <code>execute</code>, below the line that calls iput-object to set mCont, add these</p><div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line">iput-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>startupActions<span class="token punctuation">/</span></span><span class="token class-name">StartGuest</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mCont</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">.line</span> <span class="token number">260</span></span>
<span class="line"><span class="token punctuation">:</span><span class="token label property">cond_c</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">#start. add wine execute path to env </span></span>
<span class="line">iget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>startupActions<span class="token punctuation">/</span></span><span class="token class-name">StartGuest</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mCont</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>startupActions<span class="token punctuation">/</span></span><span class="token class-name">StartGuest</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mEnv</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>util<span class="token punctuation">/</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">addEnvVars</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>util<span class="token punctuation">/</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="after-modifying-dex" tabindex="-1"><a class="header-anchor" href="#after-modifying-dex"><span>after modifying dex</span></a></h3><p>After the modification of dex, add some wines to obb(and their presets) and add wines&#39; info into apk/assets/WinesVersionInfo.txt.Then you can choose specific wine version when creating a container.</p><h2 id="to-add-a-new-version-of-wine" tabindex="-1"><a class="header-anchor" href="#to-add-a-new-version-of-wine"><span>To add a new version of wine</span></a></h2><p>With an apk that supports multiwine, you can add many versions of wine by your choice. If you have difficulty understanding what is going on in this section, maybe you need to get an obb with multiple versions of wine already added, and just use it.</p><h3 id="add-wine-binary-files-into-obb" tabindex="-1"><a class="header-anchor" href="#add-wine-binary-files-into-obb"><span>add wine binary files into obb</span></a></h3><p>If you have the experience of creating and patching exagear obb, then you know better than me about how to add a wine. Here I&#39;ll only give a basic way to add orignal binary wine files. I&#39;m not sure if more operations are required(Higher versions of wine for example, need more running dependencies maybe? ).</p>`,14)),s("p",null,[n[31]||(n[31]=a("The compiled bianry package of wine can be downloaded from ")),s("a",f,[n[29]||(n[29]=a("official website")),e(p)]),n[32]||(n[32]=a(". They vary in operate systems. If the obb's linux system is ubuntu18 i386 for example, go into the ")),s("a",w,[n[30]||(n[30]=a("corresponding dir")),e(p)]),n[33]||(n[33]=a(" and choose the version you like and download the two deb —— wine.deb and wine-i386.deb(e.g. ")),n[34]||(n[34]=s("code",null,"wine-staging_4.21~bionic_i386.deb",-1)),n[35]||(n[35]=a(" and ")),n[36]||(n[36]=s("code",null,"wine-staging-i386_4.21~bionic_i386.deb",-1)),n[37]||(n[37]=a("). The next steps are illustrated int the demo video. Extract opt and usr folder from these two debs to a new folder named wine4.21(or whatever), and add folder wine4.21 into obb. Not sure if there is symbol link problem under android system, so extract them in linux system if permitted."))]),n[48]||(n[48]=i('<h3 id="add-presets-folder-into-obb-optional" tabindex="-1"><a class="header-anchor" href="#add-presets-folder-into-obb-optional"><span>add presets folder into obb(optional)</span></a></h3><p>the pattern folder is for presets like C: driver&#39;s contents, regs, etc. If you have the experience of creating and patching exagear obb, then you know it better than me. If this version of wine doesn&#39;t require a seperate pattern content, just continue to use the default folder /opt/guestcont-pattern.</p><h3 id="add-one-line-in-winesversioninfo-txt" tabindex="-1"><a class="header-anchor" href="#add-one-line-in-winesversioninfo-txt"><span>add one line in WinesVersionInfo.txt</span></a></h3><p>add a new line to apk/assets/WinesVersionInfo.txt, write three part of wine info. Seperate each part with a blank space. e.g.</p><p><code>wine4.21 /opt/wine4.21/opt/wine-staging /opt/guestcont-pattern/</code></p><ul><li>1st part: wineName. Custom name that used as the text of option when creating a new container.</li><li>2nd part: wineInstallPath. The location to find the new wine. Make sure this folder contains ./bin/wine. That is, if the absolute path of wine execute file is <code>/opt/wine4.21/opt/wine-staging/bin/wine</code>, then wineInstallPath is <code>/opt/wine4.21/opt/wine-staging</code>.</li><li>3rd part: winePatternPath. Presets for containers. Use <code>/opt/guestcont-pattern/</code> if this version of wine doesn&#39;t need seperate presets.</li></ul><h3 id="reinstall-apk-uncompress-obb-create-new-container" tabindex="-1"><a class="header-anchor" href="#reinstall-apk-uncompress-obb-create-new-container"><span>Reinstall apk, uncompress obb, create new container</span></a></h3><p>Reinstall the apk to apply changes of txt, let apk uncompress obb again to apply changes of new wine folder, create a new container to apply changes of installPath and patternPath. <strong>Every time installPath or patternPath in txt is modified, you should create a new container to use the new path, the old containers will always use the old path.</strong></p>',8))])}const L=u(k,[["render",y],["__file","index_EN.html.vue"]]),T=JSON.parse('{"path":"/blogs/2022/autumn/exagearMultiWine/index_EN.html","title":"","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Demo video","slug":"demo-video","link":"#demo-video","children":[]},{"level":2,"title":"Introduction","slug":"introduction","link":"#introduction","children":[]},{"level":2,"title":"Concept","slug":"concept","link":"#concept","children":[]},{"level":2,"title":"To modify dex(smali)","slug":"to-modify-dex-smali","link":"#to-modify-dex-smali","children":[{"level":3,"title":"My Classes","slug":"my-classes","link":"#my-classes","children":[]},{"level":3,"title":"class ManagerContainersFragment","slug":"class-managercontainersfragment","link":"#class-managercontainersfragment","children":[]},{"level":3,"title":"class GuestContainerConfig","slug":"class-guestcontainerconfig","link":"#class-guestcontainerconfig","children":[]},{"level":3,"title":"class GuestContainersManager","slug":"class-guestcontainersmanager","link":"#class-guestcontainersmanager","children":[]},{"level":3,"title":"class StartGuest","slug":"class-startguest","link":"#class-startguest","children":[]},{"level":3,"title":"after modifying dex","slug":"after-modifying-dex","link":"#after-modifying-dex","children":[]}]},{"level":2,"title":"To add a new version of wine","slug":"to-add-a-new-version-of-wine","link":"#to-add-a-new-version-of-wine","children":[{"level":3,"title":"add wine binary files into obb","slug":"add-wine-binary-files-into-obb","link":"#add-wine-binary-files-into-obb","children":[]},{"level":3,"title":"add presets folder into obb(optional)","slug":"add-presets-folder-into-obb-optional","link":"#add-presets-folder-into-obb-optional","children":[]},{"level":3,"title":"add one line in WinesVersionInfo.txt","slug":"add-one-line-in-winesversioninfo-txt","link":"#add-one-line-in-winesversioninfo-txt","children":[]},{"level":3,"title":"Reinstall apk, uncompress obb, create new container","slug":"reinstall-apk-uncompress-obb-create-new-container","link":"#reinstall-apk-uncompress-obb-create-new-container","children":[]}]}],"git":{"createdTime":1666449099000,"updatedTime":1667657199000,"contributors":[{"name":"ewt45","email":"79033456+ewt45@users.noreply.github.com","commits":2}]},"filePathRelative":"blogs/2022/autumn/exagearMultiWine/index_EN.md"}');export{L as comp,T as data};
