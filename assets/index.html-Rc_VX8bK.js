import{_ as u,c as r,a as s,d as i,e as a,b as e,f as t,r as c,o as k}from"./app-lSJJfXGm.js";const d={},m={class:"custom-container tip"},b={class:"table-of-contents"},g={href:"https://www.bilibili.com/video/BV1bD4y1k7ch?share_source=copy_web&vd_source=de2377a6a91c81456918f0dc49bfbd5d",target:"_blank",rel:"noopener noreferrer"},v={href:"https://askubuntu.com/a/1193281",target:"_blank",rel:"noopener noreferrer"},w={href:"https://wwn.lanzout.com/iduTq0dmf7cf",target:"_blank",rel:"noopener noreferrer"},f={href:"https://dl.winehq.org/wine-builds/ubuntu/dists",target:"_blank",rel:"noopener noreferrer"},x={href:"https://dl.winehq.org/wine-builds/ubuntu/dists/bionic/main/binary-i386/",target:"_blank",rel:"noopener noreferrer"};function h(C,n){const o=c("RouteLink"),p=c("router-link"),l=c("ExternalLinkIcon");return k(),r("div",null,[s("div",m,[n[3]||(n[3]=i('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">tips</p>',2)),s("p",null,[n[1]||(n[1]=a("if you have trouble reading Chinese, maybe ")),e(o,{to:"/blogs/2022/autumn/exagearMultiWine/index_EN.html"},{default:t(()=>n[0]||(n[0]=[a("this English version")])),_:1}),n[2]||(n[2]=a(" suits you better"))])]),s("nav",b,[s("ul",null,[s("li",null,[e(p,{to:"#视频演示"},{default:t(()=>n[4]||(n[4]=[a("视频演示")])),_:1})]),s("li",null,[e(p,{to:"#前言"},{default:t(()=>n[5]||(n[5]=[a("前言")])),_:1})]),s("li",null,[e(p,{to:"#思路"},{default:t(()=>n[6]||(n[6]=[a("思路")])),_:1})]),s("li",null,[e(p,{to:"#修改dex-smali"},{default:t(()=>n[7]||(n[7]=[a("修改dex(smali)")])),_:1}),s("ul",null,[s("li",null,[e(p,{to:"#我自己写的类"},{default:t(()=>n[8]||(n[8]=[a("我自己写的类")])),_:1})]),s("li",null,[e(p,{to:"#managecontainersfragment类"},{default:t(()=>n[9]||(n[9]=[a("ManageContainersFragment类")])),_:1})]),s("li",null,[e(p,{to:"#guestcontainerconfig类"},{default:t(()=>n[10]||(n[10]=[a("GuestContainerConfig类")])),_:1})]),s("li",null,[e(p,{to:"#guestcontainersmanager类"},{default:t(()=>n[11]||(n[11]=[a("GuestContainersManager类")])),_:1})]),s("li",null,[e(p,{to:"#startguest类"},{default:t(()=>n[12]||(n[12]=[a("StartGuest类")])),_:1})]),s("li",null,[e(p,{to:"#改完dex。"},{default:t(()=>n[13]||(n[13]=[a("改完dex。")])),_:1})])])]),s("li",null,[e(p,{to:"#如何添加一个新的wine版本"},{default:t(()=>n[14]||(n[14]=[a("如何添加一个新的wine版本")])),_:1}),s("ul",null,[s("li",null,[e(p,{to:"#将wine二进制包加入obb中"},{default:t(()=>n[15]||(n[15]=[a("将wine二进制包加入obb中")])),_:1})]),s("li",null,[e(p,{to:"#添加预置环境-可选"},{default:t(()=>n[16]||(n[16]=[a("添加预置环境（可选）")])),_:1})]),s("li",null,[e(p,{to:"#在winesversioninfo-txt中添加一行"},{default:t(()=>n[17]||(n[17]=[a("在WinesVersionInfo.txt中添加一行")])),_:1})]),s("li",null,[e(p,{to:"#重装apk-重新解压obb-新建环境"},{default:t(()=>n[18]||(n[18]=[a("重装apk，重新解压obb，新建环境")])),_:1})])])]),s("li",null,[e(p,{to:"#更新历史"},{default:t(()=>n[19]||(n[19]=[a("更新历史")])),_:1}),s("ul",null,[s("li",null,[e(p,{to:"#_22-10-22"},{default:t(()=>n[20]||(n[20]=[a("22.10.22")])),_:1})])])])])]),n[47]||(n[47]=s("h2",{id:"视频演示",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#视频演示"},[s("span",null,"视频演示")])],-1)),n[48]||(n[48]=s("p",null,"测试了从容器设置启动和快捷方式启动不同版本wine，添加一个新版本wine。",-1)),s("p",null,[s("a",g,[n[21]||(n[21]=a("【安卓Exagear】单apk支持多版本wine共存 大概就这样了】")),e(l)])]),n[49]||(n[49]=s("iframe",{src:"//player.bilibili.com/player.html?aid=731433211&bvid=BV1bD4y1k7ch&cid=858758941&page=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"500",height:"300"}," 不支持iframe视频无法显示",-1)),n[50]||(n[50]=s("h2",{id:"前言",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#前言"},[s("span",null,"前言")])],-1)),n[51]||(n[51]=s("p",null,"由于现在exagear的apk种类繁多，所以与其提供成品，不如讲一下如何将需要用到的代码添加到apk中，以方便各路制作者。",-1)),n[52]||(n[52]=s("p",null,"本文可能不会详细讲解：",-1)),n[53]||(n[53]=s("ul",null,[s("li",null,"打包数据包"),s("li",null,"dex/smali修改基础知识")],-1)),s("p",null,[n[23]||(n[23]=a("linux上wine共存的方法参考了")),s("a",v,[n[22]||(n[22]=a("参考教程")),e(l)]),n[24]||(n[24]=a("，因为是32位系统不用下amd64那个。"))]),s("p",null,[n[26]||(n[26]=a("这是第二次修改了，方法用的是添加环境变量。第一次用的方法是使用绝对路径调用wine，文章在这里")),e(o,{to:"/blogs/2022/autumn/exagearMultiWine/deprecated.html"},{default:t(()=>n[25]||(n[25]=[a("向exagear数据包中添加任意个数的不同wine版本(旧)")])),_:1}),n[27]||(n[27]=a("。里面讲了一些了wine的基础知识，exagear启动容器时相关的函数，修改共存的设计思路和修改流程等，本篇不再说了。虽然修改的思路依然不尽如人意，但好歹结果是实现了这个功能，暂时不打算改了。"))]),n[54]||(n[54]=i('<h2 id="思路" tabindex="-1"><a class="header-anchor" href="#思路"><span>思路</span></a></h2><p>本节主要讲了一下修改的整体思路，不全。</p><ul><li>exagear创建容器的方法为在容器管理界面点击右上角加号。如果改为多wine支持，应该在点击加号后显示几个菜单项以供用户选择wine版本。考虑到应支持任意多个而非固定个数的wine版本，并使制作者添加一个数据包的所需操作最少，采用从apk/assets/WinesVersionInfo.txt中读取wine信息，动态创建菜单项的方法。并为txt内容书写制定以下规则： <ul><li>文本采用utf-8编码，不留空行。</li><li>每一行就是一个wine版本信息，记录wine名字（自定义，用于菜单项的显示），wine安装路径（比如wine执行文件的路径为/opt/wine-stable/bin/wine，那么这一项就填/opt/wine-stable），wine预设容器路径。三条信息两两之间用空格分隔。举例：<code>wine3.0.5 /opt/wine3.0.5/opt/wine-stable /opt/guestcont-pattern/</code></li><li>以<code>#</code>开头的一行是注释。</li><li>以<code>usage:</code>开头的一行是说明，作为最后一个菜单项和wine版本菜单项一起出现。制作者可以在这里写上一些wine的版本介绍和注意事项。</li></ul></li><li>exagear创建容器时，会将/opt/guestcont-pattern目录下的虚拟windows系统复制到新容器中，这个文件夹用来做一些预制环境。对如果改为多wine支持，应支持设置不同的预制环境目录。</li><li>exagear启动容器时，会调用命令 wine 来显示虚拟桌面。由于一般wine的安装路径都包含在环境变量PATH中（如/usr/bin），所以无需指定wine程序的绝对路径。如果改为多wine支持，就要手动向环境变量PATH中添加对应版本的wine的路径。 <ul><li>exa从容器设置启动容器时调用wine命令写在了dex中，而从快捷方式启动的调用wine命令写在快捷方式文件中。</li></ul></li></ul><h2 id="修改dex-smali" tabindex="-1"><a class="header-anchor" href="#修改dex-smali"><span>修改dex(smali)</span></a></h2>',4)),s("p",null,[n[29]||(n[29]=a("编写java代码的思路先略过了。")),n[30]||(n[30]=s("br",null,null,-1)),n[31]||(n[31]=a(" 本节介绍如何修改dex以使任意一个exagear的apk支持多wine版本共存。如果本节内容对于你来说太难，那么你可能需要的是一个已经添加好多wine共存功能的apk，然后看下一节")),e(o,{to:"/blogs/2022/autumn/exagearMultiWine/#%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84wine%E7%89%88%E6%9C%AC"},{default:t(()=>n[28]||(n[28]=[a("如何添加一个新的wine版本")])),_:1})]),n[55]||(n[55]=i('<div class="custom-container warning"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></g></svg><p class="custom-container-title">注意事项</p><p>修改时可能需要注意一下几点</p><ul><li>我自己写的代码部分，提供smali文件，直接导入即可。ex的dex需要修改的部分，提供smali修改样例仅供参考，实际修改请注意寄存器，包名等。样例中为表明添加代码的位置可能会加几行原dex中的代码，复制的时候只需复制<code>#添加/修改</code>到<code>#添加/修改结束</code>的部分，原代码请自行剔除。</li><li>下面提供的代码里使用的均为原版包名即<code>com.eltechs.ed</code>。修改包名时除了类名所属包名要改，注意有个字符串也带包名记得修改。</li><li>如果测试时发现wine路径写错了，改了txt之后应删掉容器重新建，否则wine路径不会变化。</li><li>因为需要修改环境变量，测试又发现无法识别$PATH（如果添加一条PATH=/opt/wine-stable/bin, 原来那些/usr/bin, /usr/local/bin啥的都会被顶掉），所以我只好把默认的那些PATH都写上了，如果制作者的linux系统的PATH包含其他路径（或LD_LIBRARY_PATH），需要在我提供的smali中手动添加一遍（搜PATH或LD_LIBRARY_PATH即可找到位置）。</li></ul></div><hr><p>修改涉及的类：</p><ul><li>修改wine选项弹窗，涉及ManagerContainersFragment类</li><li>修改创建容器时操作，涉及GuestContainerConfig,GuestContainersManager类</li><li>修改启动容器时操作，涉及StartGuest类</li></ul><hr><h3 id="我自己写的类" tabindex="-1"><a class="header-anchor" href="#我自己写的类"><span>我自己写的类</span></a></h3>',6)),s("p",null,[s("a",w,[n[32]||(n[32]=a("下载地址")),e(l)]),n[33]||(n[33]=a("。将压缩包中全部类添加到dex中即可"))]),n[56]||(n[56]=i(`<h3 id="managecontainersfragment类" tabindex="-1"><a class="header-anchor" href="#managecontainersfragment类"><span>ManageContainersFragment类</span></a></h3><ul><li><code>onOptionsItemSelected</code>方法整个删掉。</li><li><code>onCreateOptionsMenu</code>方法，注释掉原有语句，添加<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment">#修改 调用自己的方法设置菜单，传入menu和task实例</span></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">setOptionMenu</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">android<span class="token punctuation">/</span>view<span class="token punctuation">/</span></span><span class="token class-name">Menu</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>新建一个方法<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment"># virtual methods</span></span>
<span class="line"><span class="token comment"># 添加方法 用于从外部调用，执行创建容器的task</span></span>
<span class="line"><span class="token keyword">.method</span> <span class="token keyword">public</span> <span class="token function">callToCreateNewContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token keyword">.registers</span> <span class="token number">3</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.prologue</span></span>
<span class="line">    const/4 <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token number">0x0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">58</span></span>
<span class="line">    new-instance <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment$ContAsyncTask</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    invoke-direct <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment$ContAsyncTask</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">&lt;init&gt;</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment</span></span><span class="token punctuation">;</span><span class="token builtin">I</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span>
<span class="line">    new-array <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    invoke-virtual <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>fragments<span class="token punctuation">/</span></span><span class="token class-name">ManageContainersFragment$ContAsyncTask</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token operator">[</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Object</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">android<span class="token punctuation">/</span>os<span class="token punctuation">/</span></span><span class="token class-name">AsyncTask</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">59</span></span>
<span class="line">    return-void</span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="guestcontainerconfig类" tabindex="-1"><a class="header-anchor" href="#guestcontainerconfig类"><span>GuestContainerConfig类</span></a></h3><ul><li><code>loadDefaults</code>方法。在末尾添加<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment">#添加wine版本信息</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mCont</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">writeWineVerToContainerConfig</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><code>cloneContainerConfig</code>方法，由于末尾调用getRunGuideShown()那里把p0 p1改了，而调用的自己的函数需要用到p0 p1, 所以要在这之前添加<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token comment">#添加 复制容器的wine版本信息 放在p0 p1被修改之前吧</span></span>
<span class="line"><span class="token comment"># v0旧id   </span></span>
<span class="line">iget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># v1新id</span></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">cloneWineVerToContainerConfig</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"><span class="token comment">#添加 结束</span></span>
<span class="line"><span class="token keyword">.line</span> <span class="token number">75</span></span>
<span class="line">iget-object <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token register variable">p1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mConfig</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mConfig</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-virtual <span class="token punctuation">{</span><span class="token register variable">p0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainerConfig</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">getRunGuideShown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Boolean</span></span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="guestcontainersmanager类" tabindex="-1"><a class="header-anchor" href="#guestcontainersmanager类"><span>GuestContainersManager类</span></a></h3><ul><li><code>initNewContainer</code>方法里，注释掉字符串<code>&quot;opt/guestcont-pattern&quot;</code>那一行并在下面添加<div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"> <span class="token comment"># const-string v2, &quot;/opt/guestcont-pattern/&quot;</span></span>
<span class="line"><span class="token comment">#修改 guestcont-pattern的路径</span></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">getCustomPatternPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">move-result-object <span class="token register variable">v2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="startguest类" tabindex="-1"><a class="header-anchor" href="#startguest类"><span>StartGuest类</span></a></h3><p><code>execute</code>方法，iput-object设置完mCont的下面，添加对应版本的wine的环境变量</p><div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line">iput-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>startupActions<span class="token punctuation">/</span></span><span class="token class-name">StartGuest</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mCont</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">.line</span> <span class="token number">260</span></span>
<span class="line"><span class="token punctuation">:</span><span class="token label property">cond_c</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#添加 将wine执行路径添加到环境变量</span></span>
<span class="line">iget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>startupActions<span class="token punctuation">/</span></span><span class="token class-name">StartGuest</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mCont</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>guestContainers<span class="token punctuation">/</span></span><span class="token class-name">GuestContainer</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mId</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">iget-object <span class="token register variable">v1</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>eltechs<span class="token punctuation">/</span>ed<span class="token punctuation">/</span>startupActions<span class="token punctuation">/</span></span><span class="token class-name">StartGuest</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mEnv</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>util<span class="token punctuation">/</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-static <span class="token punctuation">{</span><span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token register variable">v1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>mutiWine<span class="token punctuation">/</span></span><span class="token class-name">MutiWine</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">addEnvVars</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">Long</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>util<span class="token punctuation">/</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#添加 结束</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="改完dex。" tabindex="-1"><a class="header-anchor" href="#改完dex。"><span>改完dex。</span></a></h3><p>改完dex之后，向数据包中添加多个版本wine（和预设WINEPREFIX），在apk/assets/WinesVersionInfo.txt里写上每个wine的版本信息，在创建容器时就可以选择wine版本进行创建了。</p><h2 id="如何添加一个新的wine版本" tabindex="-1"><a class="header-anchor" href="#如何添加一个新的wine版本"><span>如何添加一个新的wine版本</span></a></h2><p>拥有一个支持多wine版本的apk后，就可以向其中添加任意多个wine版本了。如果本节内容对于你来说太难，那么你可能需要的是一个已经添加好多wine版本的数据包，直接使用。</p><p>添加一个新的wine版本，大概就是这三步：</p><h3 id="将wine二进制包加入obb中" tabindex="-1"><a class="header-anchor" href="#将wine二进制包加入obb中"><span>将wine二进制包加入obb中</span></a></h3>`,15)),s("p",null,[n[36]||(n[36]=a("对于数据包制作者，应该比我更清楚如何向数据包中添加一个wine 所以这里只说明添加原始的wine二进制包的方法，不确定制作obb时是否需要对wine进行修改或者添加其他文件。（比如高版本wine也许需要安装更多运行时依赖？）")),n[37]||(n[37]=s("br",null,null,-1)),n[38]||(n[38]=a(" 已编译好的wine二进制包可以从")),s("a",f,[n[34]||(n[34]=a("官网下载")),e(l)]),n[39]||(n[39]=a("，需要根据obb底包的系统进行选择，以ubuntu18 i386为例，")),s("a",x,[n[35]||(n[35]=a("进到这里")),e(l)]),n[40]||(n[40]=a("。然后下载对应版本（如4.21）和对应种类（devel/staging/stable）的wine.deb和wine-i386.deb这两个包（例如")),n[41]||(n[41]=s("code",null,"wine-staging_4.21~bionic_i386.deb",-1)),n[42]||(n[42]=a("和 ")),n[43]||(n[43]=s("code",null,"wine-staging-i386_4.21~bionic_i386.deb",-1)),n[44]||(n[44]=a("），接下来的操作可以参考博客开头的演示视频，将两个deb中的opt和usr文件夹解压到同一个文件夹（比如叫wine4.21)，然后将wine4.21文件夹添加到obb/opt中。不确定在安卓解压是否会有符号链接的问题，有条件最好在linux系统下解压。"))]),n[57]||(n[57]=i('<h3 id="添加预置环境-可选" tabindex="-1"><a class="header-anchor" href="#添加预置环境-可选"><span>添加预置环境（可选）</span></a></h3><p>预置环境主要是预置c盘内容、注册表项之类的，数据包制作者应该比我更清楚。如果不需要为此wine版本单独做一份预置环境，那么就用默认的/opt/guestcont-pattern里的也行。</p><h3 id="在winesversioninfo-txt中添加一行" tabindex="-1"><a class="header-anchor" href="#在winesversioninfo-txt中添加一行"><span>在WinesVersionInfo.txt中添加一行</span></a></h3><p>在apk/assets/WinesVersionInfo.txt中添加一行，填入三段信息，每段间用空格分隔。例如</p><p><code>wine4.21 /opt/wine4.21/opt/wine-staging /opt/guestcont-pattern/</code></p><ul><li>第一段：wineName。自定义的名字，用于创建容器时的wine版本选择。</li><li>第二段：wineInstallPath。根据刚才解压出来的文件夹放在数据包中的位置填写，请确保wineInstallPath目录下的bin文件夹中包含wine执行文件。也就是说如果将wine二进制包添加到obb中之后，wine执行文件的路径为<code>/opt/wine4.21/opt/wine-staging/bin/wine</code>，那么这一段就写<code>/opt/wine4.21/opt/wine-staging</code>。</li><li>第三段：winePatternPath。预设环境（c盘），exagear默认的pattern路径是<code>/opt/guestcont-pattern/</code>，如果需要为不同的wine版本配置不同的预设环境，可以修改这个路径。</li></ul><h3 id="重装apk-重新解压obb-新建环境" tabindex="-1"><a class="header-anchor" href="#重装apk-重新解压obb-新建环境"><span>重装apk，重新解压obb，新建环境</span></a></h3><p>修改重装apk以更新txt，重新解压obb以将新添加的wine解压到镜像目录下，新建环境以使新的installPath和patternPath生效。 注意目前的代码有点问题，<strong>如果修改txt中的installPath和patternPath，修改后的路径只能在新建的环境中生效，之前的环境还是用的旧路径</strong></p><h2 id="更新历史" tabindex="-1"><a class="header-anchor" href="#更新历史"><span>更新历史</span></a></h2><h3 id="_22-10-22" tabindex="-1"><a class="header-anchor" href="#_22-10-22"><span>22.10.22</span></a></h3>',10)),s("p",null,[n[46]||(n[46]=a("更新了章节")),e(o,{to:"/blogs/2022/autumn/exagearMultiWine/#%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84wine%E7%89%88%E6%9C%AC"},{default:t(()=>n[45]||(n[45]=[a("如何添加一个新的wine版本")])),_:1})])])}const j=u(d,[["render",h],["__file","index.html.vue"]]),y=JSON.parse('{"path":"/blogs/2022/autumn/exagearMultiWine/","title":"向exagear数据包中添加任意个数的不同wine版本","lang":"zh-CN","frontmatter":{"date":"2022-10-11 14:22:16","title":"向exagear数据包中添加任意个数的不同wine版本","categories":["技术","exagear"],"tags":["android","wine","linux","exagear"]},"headers":[{"level":2,"title":"视频演示","slug":"视频演示","link":"#视频演示","children":[]},{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"思路","slug":"思路","link":"#思路","children":[]},{"level":2,"title":"修改dex(smali)","slug":"修改dex-smali","link":"#修改dex-smali","children":[{"level":3,"title":"我自己写的类","slug":"我自己写的类","link":"#我自己写的类","children":[]},{"level":3,"title":"ManageContainersFragment类","slug":"managecontainersfragment类","link":"#managecontainersfragment类","children":[]},{"level":3,"title":"GuestContainerConfig类","slug":"guestcontainerconfig类","link":"#guestcontainerconfig类","children":[]},{"level":3,"title":"GuestContainersManager类","slug":"guestcontainersmanager类","link":"#guestcontainersmanager类","children":[]},{"level":3,"title":"StartGuest类","slug":"startguest类","link":"#startguest类","children":[]},{"level":3,"title":"改完dex。","slug":"改完dex。","link":"#改完dex。","children":[]}]},{"level":2,"title":"如何添加一个新的wine版本","slug":"如何添加一个新的wine版本","link":"#如何添加一个新的wine版本","children":[{"level":3,"title":"将wine二进制包加入obb中","slug":"将wine二进制包加入obb中","link":"#将wine二进制包加入obb中","children":[]},{"level":3,"title":"添加预置环境（可选）","slug":"添加预置环境-可选","link":"#添加预置环境-可选","children":[]},{"level":3,"title":"在WinesVersionInfo.txt中添加一行","slug":"在winesversioninfo-txt中添加一行","link":"#在winesversioninfo-txt中添加一行","children":[]},{"level":3,"title":"重装apk，重新解压obb，新建环境","slug":"重装apk-重新解压obb-新建环境","link":"#重装apk-重新解压obb-新建环境","children":[]}]},{"level":2,"title":"更新历史","slug":"更新历史","link":"#更新历史","children":[{"level":3,"title":"22.10.22","slug":"_22-10-22","link":"#_22-10-22","children":[]}]}],"git":{"createdTime":1664284805000,"updatedTime":1690868772000,"contributors":[{"name":"ewt45","email":"79033456+ewt45@users.noreply.github.com","commits":9}]},"filePathRelative":"blogs/2022/autumn/exagearMultiWine/index.md"}');export{j as comp,y as data};
