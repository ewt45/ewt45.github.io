import{_ as u,c as k,a as s,d as o,b as p,f as t,e as a,r as c,o as r}from"./app-lSJJfXGm.js";const d="/assets/1-D7tHCr5z.png",m="/assets/2-C-UE8V_7.png",v={},b={class:"table-of-contents"},g={href:"https://developer.android.com/develop/ui/views/components/floating-action-button",target:"_blank",rel:"noopener noreferrer"},f={href:"https://m2.material.io/components/buttons-floating-action-button",target:"_blank",rel:"noopener noreferrer"},w={href:"https://github.com/ewt45/EDPatch/releases",target:"_blank",rel:"noopener noreferrer"},y={href:"https://www.bilibili.com/video/BV1mY411X7Nn/",target:"_blank",rel:"noopener noreferrer"},h={href:"https://wwqv.lanzout.com/b012de1zc",target:"_blank",rel:"noopener noreferrer"},x={href:"https://wwqv.lanzout.com/b012de1xa",target:"_blank",rel:"noopener noreferrer"},L={href:"https://developer.android.google.cn/guide/topics/ui/menus?hl=zh-cn#context-menu",target:"_blank",rel:"noopener noreferrer"},C={href:"https://developer.android.google.cn/develop/ui/views/components/dialogs?hl=zh-cn",target:"_blank",rel:"noopener noreferrer"};function D(A,n){const e=c("router-link"),i=c("RouteLink"),l=c("ExternalLinkIcon");return r(),k("div",null,[s("nav",b,[s("ul",null,[s("li",null,[p(e,{to:"#前言"},{default:t(()=>n[0]||(n[0]=[a("前言")])),_:1})]),s("li",null,[p(e,{to:"#演示视频"},{default:t(()=>n[1]||(n[1]=[a("演示视频：")])),_:1})]),s("li",null,[p(e,{to:"#将此功能添加到apk"},{default:t(()=>n[2]||(n[2]=[a("将此功能添加到apk")])),_:1}),s("ul",null,[s("li",null,[p(e,{to:"#自助修改"},{default:t(()=>n[3]||(n[3]=[a("自助修改")])),_:1})]),s("li",null,[p(e,{to:"#手动修改"},{default:t(()=>n[4]||(n[4]=[a("手动修改")])),_:1})])])]),s("li",null,[p(e,{to:"#探索过程"},{default:t(()=>n[5]||(n[5]=[a("探索过程")])),_:1}),s("ul",null,[s("li",null,[p(e,{to:"#设置在父布局中的位置"},{default:t(()=>n[6]||(n[6]=[a("设置在父布局中的位置")])),_:1})]),s("li",null,[p(e,{to:"#设置图标和颜色"},{default:t(()=>n[7]||(n[7]=[a("设置图标和颜色")])),_:1})]),s("li",null,[p(e,{to:"#设置点击操作"},{default:t(()=>n[8]||(n[8]=[a("设置点击操作")])),_:1})]),s("li",null,[p(e,{to:"#多语言"},{default:t(()=>n[9]||(n[9]=[a("多语言")])),_:1})])])]),s("li",null,[p(e,{to:"#总结"},{default:t(()=>n[10]||(n[10]=[a("总结")])),_:1})])])]),n[28]||(n[28]=s("h2",{id:"前言",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#前言"},[s("span",null,"前言")])],-1)),n[29]||(n[29]=s("p",null,"发现as新建的安卓项目右下角自带了一个圆形按钮，拿来添加一些功能蛮不错。",-1)),n[30]||(n[30]=s("p",null,"看规范，其实用于功能整合是错误的，这个操作按钮应该只用于某一个/类明确的操作，不管那么多了=-=",-1)),n[31]||(n[31]=s("p",null,"目前已实现的功能：",-1)),s("ul",null,[s("li",null,[p(i,{to:"/blogs/2022/winter/exagearFab/driveD.html"},{default:t(()=>n[11]||(n[11]=[a("修改D盘路径")])),_:1})])]),n[32]||(n[32]=s("p",null,"参考：",-1)),s("ul",null,[s("li",null,[s("a",g,[n[12]||(n[12]=a("官网教程")),p(l)]),n[13]||(n[13]=a("（顺便吐槽一下，开发者官网的guide是一些用法示例，reference是api参考。现在又出来一个UI guide是界面相关的用法示例，cn域名还没更新完善，只能用com域名看）"))]),s("li",null,[s("a",f,[n[14]||(n[14]=a("material2规范")),p(l)]),n[15]||(n[15]=a("（这个也要吐槽一下，从开发者官网跳转过去就到m3，m3又没有这个地址，得手动搜一下）"))])]),n[33]||(n[33]=o('<p>长这样</p><p><img src="'+d+'" alt="图1"><img src="'+m+'" alt="图2"></p><h2 id="演示视频" tabindex="-1"><a class="header-anchor" href="#演示视频"><span>演示视频：</span></a></h2><h2 id="将此功能添加到apk" tabindex="-1"><a class="header-anchor" href="#将此功能添加到apk"><span>将此功能添加到apk</span></a></h2><p>推荐使用ED自助补丁一键修改。<br> 如果你掌握apk的基础修改知识，也可以照下方教程手动修改，但本页面提供的文件可能比ED自助补丁要旧。<br> 如果ED自助补丁也用不明白，那么应该去寻找已经修改好的apk直接使用。</p><h3 id="自助修改" tabindex="-1"><a class="header-anchor" href="#自助修改"><span>自助修改</span></a></h3><p>使用ED自助补丁，用户完全不需要手动编辑smali，只需点一个按钮，等待修改完成后安装新的apk即可。</p>',7)),s("p",null,[s("a",w,[n[16]||(n[16]=a("下载地址")),p(l)])]),s("p",null,[s("a",y,[n[17]||(n[17]=a("视频介绍")),p(l)])]),n[34]||(n[34]=o('<div class="custom-container warning"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></g></svg><p class="custom-container-title">WARNING</p><p>以下的修改示例代码，包名使用鲁大师包名<code>Lcom/ludashi/benchmark/</code>，请注意根据实际情况自行调整。</p></div><h3 id="手动修改" tabindex="-1"><a class="header-anchor" href="#手动修改"><span>手动修改</span></a></h3><h4 id="添加悬浮操作按钮" tabindex="-1"><a class="header-anchor" href="#添加悬浮操作按钮"><span>添加悬浮操作按钮</span></a></h4>',3)),s("p",null,[s("a",h,[n[18]||(n[18]=a("这是已经改好的apk")),p(l)]),n[19]||(n[19]=a("(密码:5obi) ，请尽量仅用作本博客所介绍的功能测试用途，因为不保证其他功能正常工作。"))]),s("p",null,[s("a",x,[n[20]||(n[20]=a("手动添加需要用到的smali压缩包")),p(l)]),n[21]||(n[21]=a("(密码:6355)。包含悬浮操作按钮和全部目前实现的操作功能。"))]),n[35]||(n[35]=o(`<p>用MT管理器编辑dex</p><ol><li><p>将上面smali压缩包中的全部smali加入dex中，如果有重复的就覆盖。</p></li><li><p>在EDMainActivity类的OnCreate方法中，return-void的前一行加上以下代码，以初始化悬浮操作按钮并将其显示到布局上。</p><div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line">    new-instance <span class="token register variable">v3</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>FAB<span class="token punctuation">/</span></span><span class="token class-name">FabMenu</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    invoke-direct <span class="token punctuation">{</span><span class="token register variable">v3</span><span class="token punctuation">,</span> <span class="token register variable">p0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>FAB<span class="token punctuation">/</span></span><span class="token class-name">FabMenu</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">&lt;init&gt;</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">android<span class="token punctuation">/</span>support<span class="token punctuation">/</span>v7<span class="token punctuation">/</span>app<span class="token punctuation">/</span></span><span class="token class-name">AppCompatActivity</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>这样就好了。注意虽然菜单可以显示，但如果想功能运行正常，还需要接着看下面对应功能的需要修改的地方。</p><h4 id="添加功能-修改d盘路径" tabindex="-1"><a class="header-anchor" href="#添加功能-修改d盘路径"><span>添加功能-修改D盘路径</span></a></h4><p>编辑dex。</p><ol><li><p>修改EDMainActivity和StartGuest这两个类的成员变量mUserAreaDir，在初始化时调用getDriveDDir()获取用户自定义路径。<br> 进入这两个类的smali后从上往下滑，找到<code>.method static constructor &lt;clinit&gt;()V</code>并修改。</p><div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"><span class="token keyword">.method</span> <span class="token keyword">static</span> <span class="token keyword">constructor</span> <span class="token function">&lt;clinit&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line">    <span class="token keyword">.registers</span> <span class="token number">3</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">.line</span> <span class="token number">51</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">#这些删掉</span></span>
<span class="line">    <span class="token comment"># new-instance v0, Ljava/io/File;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># invoke-static {}, Lcom/eltechs/axs/helpers/AndroidHelpers;-&gt;getMainSDCard()Ljava/io/File;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># move-result-object v1</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># const-string v2, &quot;Exagear&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># invoke-direct {v0, v1, v2}, Ljava/io/File;-&gt;&lt;init&gt;(Ljava/io/File;Ljava/lang/String;)V</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 改为这两行</span></span>
<span class="line">    invoke-static <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>example<span class="token punctuation">/</span>datainsert<span class="token punctuation">/</span>exagear<span class="token punctuation">/</span>FAB<span class="token punctuation">/</span>dialogfragment<span class="token punctuation">/</span></span><span class="token class-name">DriveD</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">getDriveDDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    move-result-object <span class="token register variable">v0</span></span>
<span class="line">    <span class="token comment"># 修改结束，最后一行保留不做更改</span></span>
<span class="line">    sput-object <span class="token register variable">v0</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">com<span class="token punctuation">/</span>ludashi<span class="token punctuation">/</span>benchmark<span class="token punctuation">/</span>activities<span class="token punctuation">/</span></span><span class="token class-name">EDMainActivity</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token field variable">mUserAreaDir</span><span class="token punctuation">:</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    return-void</span>
<span class="line"><span class="token keyword">.end</span> <span class="token keyword">method</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在CreateLaunchConfiguration类的execute方法中，在创建d盘符号链接前删除原有符号链接，以使新设置的路径生效。通过搜索字符串<code>&quot;/dosdevices/d:&quot;</code>定位到代码附近，然后参考下面代码在对应位置添加一行代码调用delete()删除文件。</p><div class="language-smali line-numbers-mode" data-highlighter="prismjs" data-ext="smali" data-title="smali"><pre><code><span class="line"></span>
<span class="line">const-string <span class="token register variable">v6</span><span class="token punctuation">,</span> <span class="token string">&quot;/dosdevices/d:&quot;</span></span>
<span class="line"></span>
<span class="line">invoke-virtual <span class="token punctuation">{</span><span class="token register variable">v5</span><span class="token punctuation">,</span> <span class="token register variable">v6</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">StringBuilder</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">StringBuilder</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">invoke-virtual <span class="token punctuation">{</span><span class="token register variable">v5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">StringBuilder</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">move-result-object <span class="token register variable">v5</span></span>
<span class="line"></span>
<span class="line">invoke-direct <span class="token punctuation">{</span><span class="token register variable">v3</span><span class="token punctuation">,</span> <span class="token register variable">v4</span><span class="token punctuation">,</span> <span class="token register variable">v5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">&lt;init&gt;</span><span class="token punctuation">(</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token builtin">V</span></span>
<span class="line"><span class="token comment">#添加这一行</span></span>
<span class="line">invoke-virtual <span class="token punctuation">{</span><span class="token register variable">v3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">Z</span></span>
<span class="line"><span class="token comment">#添加结束</span></span>
<span class="line">invoke-virtual <span class="token punctuation">{</span><span class="token register variable">v3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>io<span class="token punctuation">/</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token operator">-&gt;</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name"><span class="token builtin">L</span><span class="token namespace">java<span class="token punctuation">/</span>lang<span class="token punctuation">/</span></span><span class="token class-name">String</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>用户未自定义的情况下，默认设置路径为<code>/storage/emulated/0/Exagear</code>。<br> 如果想将<code>Exagear</code>改为其他：在<code>Lcom/example/datainsert/exagear/FAB/dialogfragment/DriveD</code>这个类中，修改初始化函数中<code>PREF_VAL_DST_NAME</code>的值。</p></li></ol><h2 id="探索过程" tabindex="-1"><a class="header-anchor" href="#探索过程"><span>探索过程</span></a></h2><p>本节为自用，主要记录实现java代码的过程。</p><h3 id="设置在父布局中的位置" tabindex="-1"><a class="header-anchor" href="#设置在父布局中的位置"><span>设置在父布局中的位置</span></a></h3><p>悬浮操作按钮FloatingActionButton简称fab。</p><p>将按钮添加到主界面的布局上，这个在做内置overlay的时候已经搞过了，原理是一样的（虽然说那篇博客的教程也鸽了只有代码修改示例）。基本原理就是找到activity设置的view（id是<code>0x7f09006e</code>），然后在activity onCreate的时候把自身传到自己的函数中来，这样先用context创建按钮，然后再用acitivity findViewById寻找主视图，addView就行了。</p><p>实际操作发现有个问题，就是新建工程，fab在Coordinatorlayout中，这个类似于framelayout，定位直接<code>android:layout_gravity=&quot;bottom|end&quot;</code>，然而exagear中用的是LinearLayout，由于中间的列表布局设置了matchParent，导致再添加fab会被挤到到屏幕下面不可见。后来想了想，直接设置负的margin不就好了=-=（实际写代码的时候又在margin说明里看到说这个应该是正数，就用了translationXY）</p><h3 id="设置图标和颜色" tabindex="-1"><a class="header-anchor" href="#设置图标和颜色"><span>设置图标和颜色</span></a></h3><p>exagear用的导航是drawerLayout，主题应该是用的material的。背景颜色就不管了，让它按主题的来，图标找了一个现有的齿轮向量图标，id是<code>0x7f0800aa</code>，虽说不太符合m2规范但是凑活用吧。</p><p>通过id寻找资源的时候，由于自己工程的资源id肯定和exagear的不一样，所以调用一个工具函数，传入自己工程的id和ex的id，判断当前包名如果是自己工程就返回自己工程id，否则返回ex的id，这样就不用每次编译完smali都去手动替换id了。</p><p>颜色问题，在普通ex上背景蓝色图标黑色，hugo的背景白色图标白色，所以需要根据背景颜色设置图标颜色。这个之前想写自定义按钮颜色后设置按钮文本颜色的时候实现了，大致就是调用ColorUtils判断白色文本的话是否符合最小对比度，如果不符合那就用黑色<code>int icColor = ColorUtils.calculateMinimumAlpha(Color.WHITE,bgColor,4.5f)==-1 ? Color.BLACK : Color.WHITE;</code> ，获取图标用<code>activity.getDrawable</code>, 设置矢量图表颜色用<code>iconDrawable.setTintList(ColorStateList.valueOf(icColor));</code></p><p>设置图标用<code>fab.setImageDrawable</code>，但是发现图标不会自适应宽高，所以需要先调用<code>fab.setCustomSize</code>设置fab圆的半径。虽然调用setCustomSize，但是不设置fab的layoutParams的宽高还是会有问题，也就是说宽高要设置两边=-=</p><h3 id="设置点击操作" tabindex="-1"><a class="header-anchor" href="#设置点击操作"><span>设置点击操作</span></a></h3>`,18)),s("p",null,[n[23]||(n[23]=a("不会写样式，偶然发现点击的时候有个叫ContextMenu的，")),s("a",L,[n[22]||(n[22]=a("官网教程在这")),p(l)]),n[24]||(n[24]=a("。长按视图后出现一个弹窗菜单，或者全屏的操作。没什么样式不过凑活用吧。"))]),n[36]||(n[36]=s("p",null,[a("设置setOnCreateContextMenuListener，点击菜单项后显示自定义操作的对话框。"),s("br"),a(" 设置setOnClickListener中调用"),s("code",null,"fab.showContextMenu()"),a("，这样不需要长按，点击即可出现上下文菜单。")],-1)),s("p",null,[n[26]||(n[26]=a("至于点击菜单项后的操作，想了想决定用dialogFragment，这个dialog可以获取context。")),s("a",C,[n[25]||(n[25]=a("官网教程")),p(l)]),n[27]||(n[27]=a(" 于是就用这个了。在OnCreateDialog里返回一个dialog就行。显示它的话就new然后show()，想全屏就用fragment管理器当做fragment处理。"))]),n[37]||(n[37]=o(`<p>下面是fab构建过程的代码</p><details class="custom-container details"><summary class="custom-container-title">点击展开代码</summary><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>datainsert<span class="token punctuation">.</span>exagear<span class="token punctuation">.</span></span><span class="token constant">FAB</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SuppressLint</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>res<span class="token punctuation">.</span></span><span class="token class-name">ColorStateList</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Color</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span></span><span class="token class-name">Drawable</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>design<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">FloatingActionButton</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">ColorUtils</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span></span><span class="token class-name">DrawableCompat</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v7<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AppCompatActivity</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">Gravity</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">MenuItem</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">LinearLayout</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>eltechs<span class="token punctuation">.</span>axs<span class="token punctuation">.</span>helpers<span class="token punctuation">.</span></span><span class="token class-name">AndroidHelpers</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ewt45<span class="token punctuation">.</span>exagearsupportv7<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>datainsert<span class="token punctuation">.</span>exagear<span class="token punctuation">.</span></span><span class="token constant">FAB</span><span class="token punctuation">.</span>dialogfragment<span class="token punctuation">.</span>DriveD<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>datainsert<span class="token punctuation">.</span>exagear<span class="token punctuation">.</span></span><span class="token class-name">RSIDHelper</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FabMenu</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">&quot;FabMenu&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@SuppressLint</span><span class="token punctuation">(</span><span class="token string">&quot;RtlHardcoded&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">FabMenu</span><span class="token punctuation">(</span><span class="token class-name">AppCompatActivity</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">FloatingActionButton</span> fab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FloatingActionButton</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//不知道为什么，下面设置了customSize，这里如果是wrap content 宽高都变成0</span></span>
<span class="line">        <span class="token class-name">LinearLayout<span class="token punctuation">.</span>LayoutParams</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearLayout<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">(</span><span class="token class-name">AndroidHelpers</span><span class="token punctuation">.</span><span class="token function">dpToPx</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">AndroidHelpers</span><span class="token punctuation">.</span><span class="token function">dpToPx</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//AndroidHelpers.dpToPx(60),AndroidHelpers.dpToPx(60)</span></span>
<span class="line">        params<span class="token punctuation">.</span>gravity <span class="token operator">=</span> <span class="token class-name">Gravity</span><span class="token punctuation">.</span><span class="token constant">TOP</span> <span class="token operator">|</span> <span class="token class-name">Gravity</span><span class="token punctuation">.</span><span class="token constant">RIGHT</span><span class="token punctuation">;</span></span>
<span class="line">        params<span class="token punctuation">.</span>rightMargin <span class="token operator">=</span> <span class="token class-name">AndroidHelpers</span><span class="token punctuation">.</span><span class="token function">dpToPx</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        fab<span class="token punctuation">.</span><span class="token function">setTranslationY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">AndroidHelpers</span><span class="token punctuation">.</span><span class="token function">dpToPx</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不知道为啥margin那里说应该是正数，那用translation吧</span></span>
<span class="line">        fab<span class="token punctuation">.</span><span class="token function">setElevation</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//感觉高度舍不设置都无所谓</span></span>
<span class="line">        fab<span class="token punctuation">.</span><span class="token function">setCustomSize</span><span class="token punctuation">(</span><span class="token class-name">AndroidHelpers</span><span class="token punctuation">.</span><span class="token function">dpToPx</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//要用这个设置一遍否则图片不居中</span></span>
<span class="line">        <span class="token comment">//设置图标</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Drawable</span> iconDrawable <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getDrawable</span><span class="token punctuation">(</span><span class="token class-name">RSIDHelper</span><span class="token punctuation">.</span><span class="token function">rslvID</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_menu_camera<span class="token punctuation">,</span> <span class="token number">0x7f0800aa</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置icon颜色</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>fab<span class="token punctuation">.</span><span class="token function">getBackgroundTintList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">int</span> bgColor <span class="token operator">=</span> fab<span class="token punctuation">.</span><span class="token function">getBackgroundTintList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDefaultColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0xff000000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">int</span> icColor <span class="token operator">=</span> <span class="token class-name">ColorUtils</span><span class="token punctuation">.</span><span class="token function">calculateMinimumAlpha</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">WHITE</span><span class="token punctuation">,</span>bgColor<span class="token punctuation">,</span><span class="token number">4.5f</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span></span>
<span class="line">                        <span class="token operator">?</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">BLACK</span> <span class="token operator">:</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">WHITE</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">assert</span> iconDrawable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">                iconDrawable<span class="token punctuation">.</span><span class="token function">setTintList</span><span class="token punctuation">(</span><span class="token class-name">ColorStateList</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>icColor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;FabMenu: 背景色是？&quot;</span><span class="token operator">+</span>bgColor<span class="token operator">+</span><span class="token string">&quot; 选择设置图标颜色为：&quot;</span><span class="token operator">+</span>icColor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//            DrawableCompat.setTint();</span></span>
<span class="line">            fab<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span>iconDrawable<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        fab<span class="token punctuation">.</span><span class="token function">setOnCreateContextMenuListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span>menu<span class="token punctuation">,</span> v<span class="token punctuation">,</span> menuInfo<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">MenuItem</span> item <span class="token operator">=</span> menu<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">S</span><span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token class-name">S<span class="token punctuation">.</span>E<span class="token punctuation">.</span>DriveD_Title</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            item<span class="token punctuation">.</span><span class="token function">setOnMenuItemClickListener</span><span class="token punctuation">(</span>item1 <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">new</span> <span class="token class-name">DriveD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        fab<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>view <span class="token operator">-&gt;</span> fab<span class="token punctuation">.</span><span class="token function">showContextMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//findViewById找到线性布局，添加fab和params</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//        View view = a.findViewById(R.id.ed_main_content_frame);</span></span>
<span class="line">        <span class="token class-name">View</span> view <span class="token operator">=</span> <span class="token function">getMainFrameView</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;TAG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;FabMenu: 没找到ed_main_content_frame吗&quot;</span> <span class="token operator">+</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token keyword">instanceof</span> <span class="token class-name">LinearLayout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">LinearLayout</span> edFrameLayout <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LinearLayout</span><span class="token punctuation">)</span> view<span class="token punctuation">;</span></span>
<span class="line">            edFrameLayout<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>fab<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">View</span> <span class="token function">getMainFrameView</span><span class="token punctuation">(</span><span class="token class-name">AppCompatActivity</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">RSIDHelper</span><span class="token punctuation">.</span><span class="token function">rslvID</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>app_bar_main<span class="token punctuation">,</span> <span class="token number">0x7f09006e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="多语言" tabindex="-1"><a class="header-anchor" href="#多语言"><span>多语言</span></a></h3><p>也不知道怎么设置比较好，反正感觉自己设计的很丑，哈哈。</p><p>声明变量locale <code>String locale = Globals.getAppContext().getResources().getConfiguration().locale.getLanguage();</code>可以获取当前系统语言的字符串值，2或3个字符，作为返回字符串语言的判断依据。</p><p>新建一个工具类S用于处理字符串。</p><p>新建几个枚举类E，其每个值代表一个字符串。自身有个stringValue用于记录对应语言的字符串。实现ValueSender接口，重写方法getValue()返回stringValue。每一个枚举类就是一种语言的字符串库存，所以相同含义字符串在不同枚举类中的值名称应该相同。设置其中一个枚举类E为public，用于外部想获取对应字符串的时候的标识，其他为private。</p><p>static域初始化map，键和值均为字符串。键名为：字符串对应的枚举类的值+下划线+locale，值为：对应语言的字符串。</p><p>当界面需要显示字符串时，调用S.f()获取字符串。f()传入一个枚举类型E的值如E.Dialog_PosBtn。首先检查locale是否获取，没获取就获取一下。 然后首先尝试从map中获取对应语言的字符串值，如果拿到了null，再尝试获取英语的字符串值，如果还是null，就获取中文的字符串值。由于locale只记录了2位，所以没法识别简体中文繁体中文这样细致的差别。</p><hr><p>当需要添加一个语言的时候，抄一个Enum类，static域里把这个枚举类的值和字符串也加到map里就行了。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><ul><li>aaa</li></ul>`,13))])}const S=u(v,[["render",D],["__file","index.html.vue"]]),j=JSON.parse('{"path":"/blogs/2022/winter/exagearFab/","title":"为exagear添加一个悬浮操作按钮","lang":"zh-CN","frontmatter":{"date":"2022-12-13 12:06:27","title":"为exagear添加一个悬浮操作按钮","categories":["exagear","技术"],"tags":["FloatingActionButton","material"]},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"演示视频：","slug":"演示视频","link":"#演示视频","children":[]},{"level":2,"title":"将此功能添加到apk","slug":"将此功能添加到apk","link":"#将此功能添加到apk","children":[{"level":3,"title":"自助修改","slug":"自助修改","link":"#自助修改","children":[]},{"level":3,"title":"手动修改","slug":"手动修改","link":"#手动修改","children":[]}]},{"level":2,"title":"探索过程","slug":"探索过程","link":"#探索过程","children":[{"level":3,"title":"设置在父布局中的位置","slug":"设置在父布局中的位置","link":"#设置在父布局中的位置","children":[]},{"level":3,"title":"设置图标和颜色","slug":"设置图标和颜色","link":"#设置图标和颜色","children":[]},{"level":3,"title":"设置点击操作","slug":"设置点击操作","link":"#设置点击操作","children":[]},{"level":3,"title":"多语言","slug":"多语言","link":"#多语言","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]}],"git":{"createdTime":1670991768000,"updatedTime":1679134042000,"contributors":[{"name":"ewt45","email":"79033456+ewt45@users.noreply.github.com","commits":3}]},"filePathRelative":"blogs/2022/winter/exagearFab/index.md"}');export{S as comp,j as data};
